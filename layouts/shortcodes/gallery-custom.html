{{/* Gallery Modal Shortcode for Wowchemy. */}}
{{/* Load gallery images from media library. */}}
{{/* https://github.com/wowchemy/wowchemy-hugo-themes */}}

{{/*
    Docs: https://wowchemy.com/docs/content/writing-markdown-latex/#image-gallery

    Parameters
    ----------
    album-custom : required
        Album folder in `assets/media/albums/` to load images from.
    order : default "asc"
        Sort images by title ascending (asc) or descending (desc).
    resize_options : default "750x750"
        Resize options passed to Hugo `.Fit` function (https://gohugo.io/content-management/image-processing/).
*/}}

{{/* For gallery nested in landing page sections */}}
{{ $.Page.Store.Set "has_gallery" true }}

{{/* Get album folder from album-custom parameter. */}}
{{ $album_custom := .Get "album-custom" }}
{{ $album_path := path.Join "media" "albums" $album_custom "*" }}

{{/* Gallery options */}}
{{ $sort_order := .Get "order" | default "asc" }}
{{ $resize_options := printf "%s webp" (.Get "resize_options" | default "750x750") }}

<div class="gallery-grid">
  {{ $images := resources.Match $album_path }}
  {{ range (sort $images "Name" $sort_order) }}
    {{ $image := .Fit $resize_options }}
    {{ $filename := path.Base .Name }}
    {{ $caption := "" }}
    {{ if $.Page.Params.gallery_item }}
      {{ range (where (where $.Page.Params.gallery_item "album" $album_custom) "image" $filename) }}
        {{ $caption = .caption }}
      {{ end }}
    {{ end }}
    <div class="gallery-item">
      <a href="{{ .RelPermalink }}" data-fancybox="gallery-{{ $album_custom }}">
        <img src="{{ $image.RelPermalink }}" loading="lazy" alt="{{ $caption }}" width="{{ $image.Width }}" height="{{ $image.Height }}">
      </a>
      {{ if $caption }}
        <div class="caption">{{ $caption }}</div>
      {{ end }}
    </div>
  {{ else }}
    {{ errorf "Unable to load gallery `%s` in `%s`." $album_path .Page.File.Filename }}
  {{ end }}
</div>
